<!DOCTYPE html>
<html lang="shadiao">
<head>
	<meta charset="UTF-8">
	<title>阿姨，生日快乐</title>
	<meta http-equiv="refresh" content="20;url=https://hustfishball.github.io/LoveTree/">
	<style>
		canvas {
			position: absolute;
			top: 0;
			left: 0;
		}
	</style>
	<script>
		window.onload = function(){
			var c = document.getElementById('c');
			var w = c.width = window.innerWidth,
			h = c.height = window.innerHeight,
			ctx = c.getContext( '2d' ),
			opts = {
				phrases: [ "阿姨", "你迟到了很多年 \n可我依然为你的到来而高兴", "看了看 \n能给你的东西实在不多", "想把这辈子最单纯的喜欢 \n数不尽的温柔都给你",
					  "我不知道怎么做 \n但遇到你之后“，”我怕自己配不上你，我有在努力的让自己变得更好","生日快乐噢！","要一直一直开心！"],
				balloons: 50,
				baseVelY: -1,
				addedVelY: -1,
				baseVelX: -.25,
				addedVelX: .5,
				baseSize: 20,
				addedSize: 10,
				baseSizeAdder: 2,
				addedSizeAdder: 2,
				baseIncrementer: .01,
				addedIncrementer: .03,
				baseHue: -10,
				addedHue: 30,
				font: '17px Verdana'
			},
			cycle = 0,
			balloons = [];
			ctx.font = opts.font;
			ctx.color = "#D1EEEE"
			function Balloon(){
				this.reset();
			}

			Balloon.prototype.reset = function(){
				this.size = opts.baseSize + opts.addedSize * Math.random();
				this.sizeAdder = opts.baseSizeAdder + opts.addedSizeAdder * Math.random();
				this.incrementer = opts.baseIncrementer + opts.addedIncrementer * Math.random();
				this.tick = 0;
				this.x = Math.random() * w;
				this.y = h + this.size;
				this.vx = opts.baseVelX + opts.addedVelX * Math.random();
				this.vy = opts.baseVelY + opts.addedVelY * Math.random();
				this.color = 'hsla(hue,70%,60%,.8)'.replace( 'hue', opts.baseHue + opts.addedHue * Math.random() );
				this.phrase = opts.phrases[ ++cycle % opts.phrases.length ].split( '\n' );
				this.lengths = [];
				for( var i = 0; i < this.phrase.length; ++i )
				this.lengths.push( -ctx.measureText( this.phrase[ i ] ).width / 2 );
			}

			Balloon.prototype.step = function(){
				this.tick += this.incrementer;
				this.x += this.vx;
				this.y += this.vy;
				var size = this.size + this.sizeAdder * Math.sin( this.tick );
				ctx.lineWidth = size / 40;
				ctx.strokeStyle = '#000';
				ctx.beginPath();
				ctx.moveTo( this.x, this.y - 2 );
				ctx.lineTo( this.x, this.y + size );
				ctx.stroke();
				ctx.fillStyle = this.color;
				ctx.translate( this.x, this.y );
				ctx.rotate( Math.PI / 4 );
				//ctx.fillRect( -size / 2, -size / 2, size / 2, size / 2 );
				ctx.beginPath();
				ctx.moveTo( 0, 0 );
				ctx.arc( -size / 2, -size / 2 + size / 4, size / 4, Math.PI / 2, Math.PI * 3 / 2 );
				ctx.arc( -size / 2 + size / 4, -size / 2, size / 4, Math.PI, Math.PI * 2 );
				ctx.lineTo( 0, 0 );
				ctx.fill();
				ctx.rotate( -Math.PI / 4 );
				ctx.translate( -this.x, -this.y );
				ctx.translate( this.x, this.y + size + 15 );
				ctx.scale( size / this.size, size / this.size );
				ctx.fillStyle = '#000';
				for( var i = 0; i < this.phrase.length; ++i )
					ctx.fillText( this.phrase[ i ], this.lengths[ i ], i * 15 );
				ctx.scale( this.size / size, this.size / size );
				ctx.translate( -this.x, -( this.y + size + 15 ) );
				if( this.y < -size * 3 )
					this.reset();
			}

			function anim(){
				window.requestAnimationFrame( anim );
				ctx.fillStyle = "#EEE9BF";
				ctx.fillRect( 0, 0, w, h );
				
				if( balloons.length < opts.balloons && Math.random() < .01 )
					balloons.push( new Balloon );
				
				for( var i = 0; i < balloons.length; ++i )
					balloons[ i ].step();
			}
			anim();
		}
	</script>
</head>
<body>
	<canvas id=c></canvas>
</body>
</html>
